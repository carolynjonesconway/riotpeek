<!DOCTYPE html>
<html>
<head>
	<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
	<style type="text/css">

	body {
		text-align: center;
		background-color: #D3D3D1;
	}

	#top-row {
		background-image: url('static/img/caitlyn.jpg');
		background-size: 100%;
		background-repeat: no-repeat;
		margin-bottom: 2em;
	}

	h1, #game-status {
		text-shadow: 2px 2px 0 #000, -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000;
		color: white;
	}

	table, th, td {
		text-align: center;
		margin: 0 auto;
	}

	table {
		width: 60%;
		background-color: rgba(255,255,255,0.5);
	}

	</style>

	<title>RiotPeek</title>
</head>
<body>
	<div class="container-fluid">
		<div id="top-row" class="row">
			<div class="col-xs-12">
				<h1>RiotPeek</h1>
				<form>
					<label class="form-group">
						<input id="summoner-name" class="form-control" type="text" value="grizzlies" placeholder="summoner">
					</label>
					<label class="form-group">
						<input id="summoner-submit" class="btn btn-default" type="submit">
					</label>
				</form>
				<p id="game-status" style="height: 25px"></p>
				<img src="/static/img/loading.gif" class="invisible" style="width: 60px">

			</div>
		</div>
		<div class="row" style="height: 250px">
			<div class="col-xs-12 col-sm-6">
				<table class="invisible table table-hover">
					<thead>
						<th>Summoner</th>
						<th>Champion</th>
					</thead>
					<tbody id="teamOne"></tbody>
				</table>
			</div>
			<div class="col-xs-12 col-sm-6">
				<table class="invisible table table-hover">
					<thead>
						<th>Summoner</th>
						<th>Champion</th>
					</thead>
					<tbody id="teamTwo"></tbody>
				</table>
			</div>
		</div>
		<p>RiotPeek is not endorsed by Riot Games and does not reflect the views or opinions of Riot Games or anyone officially involved in producing or managing League of Legends. League of Legends and Riot Games are trademarks or registered trademarks of Riot Games, Inc. League of Legends Â© Riot Games, Inc.
		</p>
	</div>

<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.6/moment.min.js"></script>
<script>

$('#summoner-submit').click(findGame);

function findGame(evt) {
	evt.preventDefault();

	// Get summoner name from the DOM
	var summoner = $('#summoner-name').val();
	var formInput = {
		summoner: summoner
	};
	
	// Update the DOM for loading
	$('img').removeClass('invisible');
	$('table').addClass('invisible');
	$('#game-status').text('');
	$('#teamOne').text('');
	$('#teamTwo').text('');

	// Get the game from the Riot API
	$.get('/find_game', formInput, function(response) {
		var game = JSON.parse(response).game;
		var summonerId = JSON.parse(response).summonerId;

		if (summonerId) {
			if (game) {

				// Determine game duration
				var gameStartEpochMillesecs = game.gameStartTime;
				var gameStartEpochSecs = gameStartEpochMillesecs/1000;
				var gameStart = moment.unix(gameStartEpochSecs);
				var gameDuration = moment(gameStart).fromNow(true);

				// Determine game type
				var ranked = [4, 6, 9, 41, 42];
				if (game.gameQueueConfigId in ranked) {
					var gameType = 'ranked'
				} else {
					var gameType = 'normal'
				};

				
				var teamOneId = game.participants[0].teamId

				// Add player info to the DOM
					
				var champions = {1: 'Annie', 2: 'Olaf', 3: 'Galio', 4: 'Twisted Fate', 5: 'Xin Zhao', 6: 'Urgot', 7: 'LeBlanc', 8: 'Vladimir', 9: 'Fiddlesticks', 10: 'Kayle', 11: 'Master Yi', 12: 'Alistar', 13: 'Ryze', 14: 'Sion', 15: 'Sivir', 16: 'Soraka', 17: 'Teemo', 18: 'Tristana', 19: 'Warwick', 20: 'Nunu', 21: 'Miss Fortune', 22: 'Ashe', 23: 'Tryndamere', 24: 'Jax', 25: 'Morgana', 26: 'Zilean', 27: 'Singed', 28: 'Evelynn', 29: 'Twitch', 30: 'Karthus', 31: "Cho'Gath", 32: 'Amumu', 33: 'Rammus', 34: 'Anivia', 35: 'Shaco', 36: 'Dr. Mundo', 37: 'Sona', 38: 'Kassadin', 39: 'Irelia', 40: 'Janna', 41: 'Gangplank', 42: 'Corki', 43: 'Karma', 44: 'Taric', 45: 'Veigar', 48: 'Trundle', 50: 'Swain', 51: 'Caitlyn', 53: 'Blitzcrank', 54: 'Malphite', 55: 'Katarina', 56: 'Nocturne', 57: 'Maokai', 58: 'Renekton', 59: 'Jarvan IV', 60: 'Elise', 61: 'Orianna', 62: 'Wukong', 63: 'Brand', 64: 'Lee Sin', 67: 'Vayne', 68: 'Rumble', 69: 'Cassiopeia', 72: 'Skarner', 74: 'Heimerdinger', 75: 'Nasus', 76: 'Nidalee', 77: 'Udyr', 78: 'Poppy', 79: 'Gragas', 80: 'Pantheon', 81: 'Ezreal', 82: 'Mordekaiser', 83: 'Yorick', 84: 'Akali', 85: 'Kennen', 86: 'Garen', 89: 'Leona', 90: 'Malzahar', 91: 'Talon', 92: 'Riven', 96: "Kog'Maw", 98: 'Shen', 99: 'Lux', 101: 'Xerath', 102: 'Shyvana', 103: 'Ahri', 104: 'Graves', 105: 'Fizz', 106: 'Volibear', 107: 'Rengar', 110: 'Varus', 111: 'Nautilus', 112: 'Viktor', 113: 'Sejuani', 114: 'Fiora', 115: 'Ziggs', 117: 'Lulu', 119: 'Draven', 120: 'Hecarim', 121: "Kha'Zix", 122: 'Darius', 126: 'Jayce', 127: 'Lissandra', 131: 'Diana', 133: 'Quinn', 134: 'Syndra', 143: 'Zyra', 150: 'Gnar', 154: 'Zac', 157: 'Yasuo', 161: "Vel'Koz", 201: 'Braum', 222: 'Jinx', 236: 'Lucian', 238: 'Zed', 254: 'Vi', 266: 'Aatrox', 267: 'Nami', 268: 'Azir', 412: 'Thresh', 421: "Rek'Sai", 429: 'Kalista'};


				// Calculate player info
				for (var i=0; i < game.participants.length; i++) {
					var participant = game.participants[i]
					var participantInfo = $('<li>').text(participant.summonerName)

					// Determine the correct champions
					participantInfo = '<tr>\
											<td>' + participant.summonerName + '</td>\
											<td>' + champions[participant.championId] + '</td>\
										</tr>';

					// Determine the correct teams
					if (participant.teamId === teamOneId) {
						$('#teamOne').append(participantInfo);
					} else {
						$('#teamTwo').append(participantInfo);
					};

					// Determine searched player's champion
					if (participant.summonerName.toLowerCase() == summoner) {
						var champ = champions[participant.championId]
					};
				};

				var gameStatus = summoner + ' has been in a ' + gameType + ' game as ' + champ + ' for ' + gameDuration + '.';

				$('table').removeClass('invisible');
			} else {
				var gameStatus = summoner + ' is not currently in game.'
			};
		} else {
			var gameStatus = 'No summoner by the name ' + summoner + ' could be found.'
		};
		$('img').addClass('invisible');
		console.log(gameStatus);
		$('#game-status').text(gameStatus);
	})
}


</script>
</body>
</html>